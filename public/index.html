<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Any2cn</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- CSS -->
    <link href="assets/application.css" rel="stylesheet">
    <style type="text/css">
      /* Sticky footer styles

      -------------------------------------------------- */

      html,
      body {
        height: 100%;
        /* The html and body elements cannot have any padding or margin. */
      }

      /* Wrapper for page content to push down footer */
      #wrap {
        min-height: 100%;
        height: auto !important;
        height: 100%;
        /* Negative indent footer by it's height */
        margin: 0 auto -60px;
      }

      /* Set the fixed height of the footer here */
      #footer {
        height: 60px;
      }
      #footer {
        background-color: #f5f5f5;
      }

      /* Lastly, apply responsive CSS fixes as necessary */
      @media (max-width: 767px) {
        #footer {
          margin-left: -20px;
          margin-right: -20px;
          padding-left: 20px;
          padding-right: 20px;
        }
      }

      /* Custom page CSS
      -------------------------------------------------- */
      /* Not required for template or sticky footer method. */

      .container {
        width: auto;
        max-width: 680px;
      }
      .container .credit {
        margin: 20px 0;
      }

    </style>

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//cdnjs.bootcss.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
    <![endif]-->

  </head>

  <body>
    <!-- Part 1: Wrap all page content here -->
    <div id="wrap">

      <!-- Begin page content -->
      <div class="container">
        <div class="page-header">
          <h1>Any2cn</h1>
        </div>
        <p class="lead">有篇外语资料，试试看能不能找到中文版。</p>
        
        <form accept-charset="UTF-8" action="/s" method="post">
          <div class="input-append">
            <input type="text" class="input-xxlarge" placeholder="文章标题或网址..." id="q" name="q" />
            <input type="submit" name="commit" class="btn" value="搜索" />
          </div>
        </form>
        <p>发现一篇很Cool的译文，<a href="#myModal" data-toggle="modal" id="share">立即分享</a>！</p>
      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">
          <a href="#">关于</a>
           |
          <a href="https://github.com/wangcash/any2cn">源码</a>
           |
          <a href="http://weibo.com/any2cn">微博</a>
        </p>
      </div>
    </div>
     
    <!-- Modal -->
    <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="myModalLabel">发布译文</h3>
      </div>
      <div class="modal-body">
        <div class="alert alert-error" id="alert" style="display:none;"></div>
        <div id="form_div"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
        <button type="button" class="btn btn-success btn-signin" id="btn_submit" data-loading-text="提交中..." data-complete-text="完成!">确定</button>
      </div>
    </div>


  <script src="assets/application.js"></script>
  <script type="text/javascript">
  $(document).ready(function() {

    //立即分享
    $("#share").click(function() {
      $("#form_div").load("submit");
    });

    //发布译文
    $("#btn_submit").click(function() {

      $("#alert").slideUp("fast"); //关闭警告框

      if($("#submit_origin_url").val() == '') {
        $("#submit_origin_url").popover("show");
        return
      }

      if($("#submit_origin_title").val() == '') {
        $("#submit_origin_title").popover("show");
        return
      }

      if($("#submit_translate_url").val() == '') {
        $("#submit_translate_url").popover("show");
        return
      }

      if($("#submit_translate_title").val() == '') {
        $("#submit_translate_title").popover("show");
        return
      }

      $("#btn_submit").button("loading");
      
      $.getJSON("/submit/s",
      {
        utf8                  :$("input[name='utf8']").val(),
        authenticity_token    :$("input[name='authenticity_token']").val(),
        submit_origin_url     :$("#submit_origin_url").val(),
        submit_origin_title   :$("#submit_origin_title").val(),
        submit_translate_url  :$("#submit_translate_url").val(),
        submit_translate_title:$("#submit_translate_title").val(),
        submit_sharer         :$("#submit_sharer").val(),
        submit                :"submit"
      },
      function(data, status, xhr) {
        if (status == "success") {
          $("#btn_submit").button("complete");
          if (data.errors == null) {
            $("#alert").removeClass("alert-error");
            $("#alert").addClass("alert-success");
            $("#alert").html("发布成功！");
            $("#alert").slideDown("fast");
            //延时1.5秒后跳转到搜索结果
            setTimeout(function(){location.href="s?q="+data.origin.url;},1500);
          }
          else {
            $("#btn_submit").button("reset");
            $("#alert").html("")
            for (var i = 0; i < data.errors.length; i++) {
              $("#alert").append(data.errors[i]+"<br>");
            };
            $("#alert").slideDown("fast");
          }
        }        
      });

    });

  });
  </script>
  </body>
</html>


